(function(){var e=this;var b={};var d=e.Kaete=function(i){this.template=i;if(typeof b[i]==="undefined"){this.compile();b[i]={func:this.func,func_body:this.func_body}}else{this.func=b[i].func;this.func_body=b[i].func_body}};d.TAG_START="[";d.TAG_END="]";d.TAG_CODE_START="%";d.TAG_CODE_END="%";d.TAG_COMMENT_START="#";d.TAG_COMMENT_END="#";d.TAG_VARIABLE_START="[";d.TAG_VARIABLE_END="]";d.TAG_VARIABLE_UNESCAPED="*";var h;var c=function(){var i=function(j){return j.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};h=new RegExp(i(d.TAG_START)+"(?:"+i(d.TAG_CODE_START)+"([\\s\\S]+?)"+i(d.TAG_CODE_END)+"|"+i(d.TAG_VARIABLE_START)+"("+i(d.TAG_VARIABLE_UNESCAPED)+"?)([\\s\\S]+?)"+i(d.TAG_VARIABLE_END)+"|"+i(d.TAG_COMMENT_START)+"[\\s\\S]+?"+i(d.TAG_COMMENT_END)+")"+i(d.TAG_END),"g")};var a="__Kaete_print";var f="__Kaete_context";var g=/[&<>"'\/]/g;d.escape_html=function(i){return(""+i).replace(g,function(j){return"&#"+j.charCodeAt(0)+";"})};d.prototype.compile=function(){var p=0,l=false,j=[];if(!h){c()}var i=function(r,q){if(r){if(l){j.push(",\n")}else{l=true;j.push(a,".push(")}if(!q){j.push("Kaete.escape_html(")}j.push(r);if(!q){j.push(")")}}};var o=function(q){if(q){i(JSON.stringify(q),true)}};var n=function(q){if(q){if(l){j.push(");\n");l=false}j.push(q,"\n")}};j.push("var ",a," = [];\n","var print_unescaped = function() { ",a,".push.apply(",a,", arguments); };\n","var print = function() { for (var i = 0; i < arguments.length; i++) { ",a,".push(Kaete.escape_html(arguments[i])); }; };\n","with (",f,") {\n");var k;while(k=h.exec(this.template)){o(this.template.slice(p,k.index));n(k[1]);i(k[3],k[2]);p=k.index+k[0].length}o(this.template.substr(p));if(l){j.push(");")}j.push("\n};\n","return ",a,'.join("");');this.func_body=j.join("");try{this.func=new Function(f,this.func_body)}catch(m){this.func=function(){return"Error compiling template: "+m.message}}};d.prototype.render=function(j){try{return this.func.call(e,j||{})}catch(i){return"Error rendering template: "+i.message}};d.render=function(k,j){var i=new d(k);return i.render(j)};d.configure=function(i){if(i){for(var j in i){if(/^[A-Z_0-9]+$/.test(j)&&(typeof d[j]!=="undefined")){d[j]=i[j]}else{alert("Kaete.configure(): Invalid option. ["+j+"="+JSON.stringify(i[j])+"]")}}}c()}}).call(this);